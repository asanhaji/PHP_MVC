<?php
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// 1. getAllCommentscles();
// 2. getCommentByFilter();
// 3. createComment();
// 4. updateComment();
// 5. deleteComment();
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

include('../Config/db.php');
include('../Models/Objects/Comment.php');

class CommentsModel {

  protected $ladate;
  private $_commentsList;

  public function __CONSTRUCT() {
    date_default_timezone_set('UTC');
    $this->ladate = date('Y-m-d');
  }
  ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  // NUMBER 1 => Get All Comments
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


  public function getAllComments() {
    $comment = Database::getInstance()->read("comments", "*");
    if($comment != NULL) {
      $this->_commentsList = [];
      foreach ($comment as $key => $value) {
        $newComment = new Comment($value['id'], $value['content'], $value['article_id'], $value['user_id'], $value['creation_date'], $value['edition_date']);
        array_push($this->_commentsList, $newComment);
      }
      return $this->_commentsList;
    }
    return NULL;
  }

  ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  // NUMBER 2 => Get Specific Comments (one or more)
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  public function getCommentByFilter(...$param){
    $i = 0;
    while($i < count($param)) {
      $array[$param[$i]] = $param[$i+1];
      $i += 2;
    }
    $comment = Database::getInstance()->read("comments", "*", $array);
    if($comment != NULL) {
      $this->_commentsList = [];
      foreach ($comment as $key => $value) {
        $newComment = new Comment($value['id'], $value['content'], $value['article_id'], $value['user_id'], $value['creation_date'], $value['edition_date']);
        array_push($this->_commentsList, $newComment);
      }
      return $this->_commentsList;
    }
    return NULL;
  }

  ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  // NUMBER 3 => Creation of a Comment
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  public function createComment($content, $article_id, $user_id){
    $array = array(
      "content" => $content,
      "article_id" => $article_id,
      "user_id" => $user_id,
      "creation_date" => $this->ladate,
      "edition_date" => $this->ladate,
    );
    $comment = Database::getInstance()->create("comments", $array);
    return $comment;
  }

  ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  // NUMBER 4 => Modification of a Comment
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  public function updateComment($id, ...$param) {
    $i = 0;
    while($i < count($param)) {
      $array[$param[$i]] = $param[$i+1];
      $i += 2;
    }
    $array['edition_date'] = $this->ladate;
    $comment = Database::getInstance()->update("comments", "id", $id, $array);
    return $comment;
  }

  ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  // NUMBER 5 => Deletion of a Comment
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  public function deleteComment(...$param) {
    $i = 0;
    while($i < count($param)) {
      $array[$param[$i]] = $param[$i+1];
      $i += 2;
    }
    $comment = Database::getInstance()->delete("comments", $array);
    return $comment;
  }
}
?>
